<!DOCTYPE HTML>
<html>
	<head>
		<title>TheNatureOfCode - Showcase</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="is-preload">
		<!-- wrapper -->
		<div id="wrapper">
			<!-- main -->
			<div id="main">
				<div class="inner">
					<!-- header -->
					<header id="header">
						The Nature Of Code &nbsp;<strong> Chp05 - Physics Libraries</strong>
							<ul class="icons">
								<li>
									<a href="https://github.com/liz-peng/TheNatureOfCode-p5.js.git" target="_blank" class="icon fa-github"></a>
								</li>
							</ul>
					</header>

					<!-- section 5.1 -->
					<section class="banner">
						<div class="content">
							<header>
								<h3>Example 5.1<br>Box2D Exercise
								</h3>
							</header>
							<p>
								Click and drag to add box &nbsp; <a href="https://editor.p5js.org/liz-peng/sketches/SKEEkA1Yu" target="_blank" class="button">p5.js</a>
							</p>
							<!-- code -->
							<pre><code>let boxes = []; //list to store all the box objects

function setup() {
  createCanvas(560, 390);
  let text = createP("Click and drag to add box");
  text.position(15, 5);
}

function draw() {
  background(220);

  //when the mouse is pressed, add a new box object
  if (mouseIsPressed) {
    let b = new Box(mouseX, mouseY);
    boxes.push(b);
  }
  //display all the box objects
  for (let i = 0; i < boxes.length; i++) {
    boxes[i].display();
  }
}

class Box {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.w = 16;
    this.h = 16;
  }

  display() {
    rectMode(CENTER);
    fill(63,63,147);
    stroke(50);
    strokeWeight(2);
    rect(this.x, this.y, this.w, this.h);
  }
}
							</code></pre>
						</div>
						<span class="p5 object">
							<iframe style="width: 100%; height: 100%; overflow: hidden; padding-top: 36px;" scrolling="no" src="https://editor.p5js.org/liz-peng/embed/SKEEkA1Yu"></iframe>
						</span>
					</section>

                    <!-- section 5.1 -->
                    <section class="banner">
                        <div class="content">
                            <header>
                                <h3>Example 5.1<br>Box2D Exercise Solved
                                </h3>
                            </header>
                            <p>
                                Click and drag to add box &nbsp; <a href="https://editor.p5js.org/liz-peng/sketches/AzZglMfOG" target="_blank" class="button">p5.js</a>
                            </p>
                            <!-- code -->
                            <pre><code>//reference to box2d world
let world;

//list to store all the box objects
let boxes = [];

function setup() {
  createCanvas(560, 390);
    let text = createP("Click and drag to add box");
  text.position(10, 5);
  
  //initialize box2d physics and create the world
  world = createWorld(new box2d.b2Vec2(0, 0));

}

function draw() {
  background(220);

  //we must always step through time
  let timeStep = 1.0 / 30;
  //second and third arguments are velocity and position iterations
  world.Step(timeStep, 10, 10);

  //when the mouse is pressed, add a new box object
  if (mouseIsPressed) {
    let b = new Box(mouseX, mouseY);
    boxes.push(b);
  }
  //display all the box objects
  for (let i = 0; i < boxes.length; i++) {
    boxes[i].display();
  }
}
class Box {
  constructor(x, y) {
    this.w = 16;
    this.h = 16;

    //define a body
    let bd = new box2d.b2BodyDef();
    bd.type = box2d.b2BodyType.b2_dynamicBody;
    bd.position = scaleToWorld(x, y);

    //define a fixture
    let fd = new box2d.b2FixtureDef();
    //fixture holds shape
    fd.shape = new box2d.b2PolygonShape();
    fd.shape.SetAsBox(scaleToWorld(this.w / 2), scaleToWorld(this.h / 2));

    // Some physics
    fd.density = 1.0;
    fd.friction = 0.5; //set physics parameter
    fd.restitution = 0.2;

    //create the body
    this.body = world.CreateBody(bd);
    //attach the shape to the body with the fixture
    this.body.CreateFixture(fd);
  }

  display() {
    //get the body's position
    let pos = scaleToPixels(this.body.GetPosition());
    //get its angle of rotation
    let a = this.body.GetAngleRadians();
        
    //drawing object using rect()
    rectMode(CENTER);
    push();
    translate(pos.x, pos.y);
    rotate(a);
    fill(63,63,147);
    stroke(50);
    strokeWeight(2);
    rect(0, 0, this.w, this.h);
    pop();
  }
}
                            </code></pre>
                        </div>
                        <span class="p5 object">
                            <iframe style="width: 100%; height: 100%; overflow: hidden; padding-top: 36px;" scrolling="no" src="https://editor.p5js.org/liz-peng/embed/AzZglMfOG"></iframe>
                        </span>
                    </section>

                    <!-- section 5.2 -->
                    <section class="banner">
                        <div class="content">
                            <header>
                                <h3>Example 5.2<br>Falling Boxes Hitting Boundaries
                                </h3>
                            </header>
                            <p>
                                <a href="https://editor.p5js.org/liz-peng/sketches/Cz_01jAw1" target="_blank" class="button">p5.js</a>
                            </p>
                            <!-- code -->
                            <pre><code>//reference to box2d world
let world;
//list to track fixed objects
let boundaries = [];
//list to store all the box objects
let boxes = [];

function setup() {
  createCanvas(560, 390);

  //initialize box2d physics and create the world
  world = createWorld();

  //add fixed boundaries
  boundaries.push(new Boundary(width / 4, height - 5, width / 2 - 50, 10));
  boundaries.push(new Boundary(3 * width / 4, height - 50, width / 2 - 50, 10));

  let b = new Box(width / 2, 30);
  boxes.push(b);
}

function draw() {
  background(220);

  //we must always step through time
  let timeStep = 1.0 / 30;
  //second and third arguments are velocity and position iterations
  world.Step(timeStep, 10, 10);

  //boxes fall from the top every so often
  if (random(1) < 0.2) {
    let b = new Box(width / 2, 30);
    boxes.push(b);
  }

  //display all the boundaries
  for (let i = 0; i < boundaries.length; i++) {
    boundaries[i].display();
  }

  //display all the box objects
  for (let i = boxes.length - 1; i >= 0; i--) {
    boxes[i].display();
    if (boxes[i].done()) {
      boxes.splice(i, 1);
    }
  }
}
class Box {
  constructor(x, y) {
    this.w = random(4, 40);
    this.h = random(4, 40);

    //build Box2D body and shape
    let bd = new box2d.b2BodyDef();
    bd.type = box2d.b2BodyType.b2_dynamicBody;
    bd.position = scaleToWorld(x, y);

    //define a fixture
    let fd = new box2d.b2FixtureDef();
    //fixture holds shape
    fd.shape = new box2d.b2PolygonShape();
    fd.shape.SetAsBox(scaleToWorld(this.w / 2), scaleToWorld(this.h / 2));

    //some physics
    fd.density = 1.0;
    fd.friction = 0.5;
    fd.restitution = 0.2;

    //create the body
    this.body = world.CreateBody(bd);
    //attach the shape to the body with the fixture
    this.body.CreateFixture(fd);

    //some additional stuff
    this.body.SetLinearVelocity(new box2d.b2Vec2(random(-5, 5), random(2, 5)));
    this.body.SetAngularVelocity(random(-5, 5));
  }

  //this function removes the particle from the box2d world
  killBody() {
    world.DestroyBody(this.body);
  }

  //check if the particle ready for deletion
  done() {
    //find the screen position of the particle
    let pos = scaleToPixels(this.body.GetPosition());
    //check if it is off the bottom of the screen
    if (pos.y > height + this.w * this.h) {
      this.killBody();
      return true;
    }
    return false;
  }

  //draw the box
  display() {
    //get the body's position
    let pos = scaleToPixels(this.body.GetPosition());
    //get its angle of rotation
    let a = this.body.GetAngleRadians();

    //drawing object using rect()
    rectMode(CENTER);
    push();
    translate(pos.x, pos.y);
    rotate(a);
    fill(63,63,147);
    stroke(50);
    strokeWeight(2);
    rect(0, 0, this.w, this.h);
    pop();
  }
}
//boundary is simple rectangle with x,y,width,and height
class Boundary {
  constructor(x, y, w, h) {
    this.x = x;
    this.y = y;
    this.w = w;
    this.h = h;

    let fd = new box2d.b2FixtureDef();
    fd.density = 1.0;
    fd.friction = 0.5;
    fd.restitution = 0.2;

    let bd = new box2d.b2BodyDef();

    bd.type = box2d.b2BodyType.b2_staticBody;
    bd.position.x = scaleToWorld(this.x);
    bd.position.y = scaleToWorld(this.y);
    fd.shape = new box2d.b2PolygonShape();
    fd.shape.SetAsBox(this.w / (scaleFactor * 2), this.h / (scaleFactor * 2));
    this.body = world.CreateBody(bd).CreateFixture(fd);
  }

  //draw the boundary
  display() {
    fill(100);
    stroke(50);
    rectMode(CENTER);
    rect(this.x, this.y, this.w, this.h);
  }
}
                            </code></pre>
                        </div>
                        <span class="p5 object">
                            <iframe style="width: 100%; height: 100%; overflow: hidden; padding-top: 36px;" scrolling="no" src="https://editor.p5js.org/liz-peng/embed/Cz_01jAw1"></iframe>
                        </span>
                    </section>

                    <!-- section 5.3 -->
                    <section class="banner">
                        <div class="content">
                            <header>
                                <h3>Example 5.3<br>ChainShape With Three Hard-Coded Vertices
                                </h3>
                            </header>
                            <p>
                                <a href="https://editor.p5js.org/liz-peng/sketches/OqPd_U7U7" target="_blank" class="button">p5.js</a>
                            </p>
                            <!-- code -->
                            <pre><code>//reference to box2d world
let world;
//list of particles
let particles = [];
//an object to store information about the uneven surface
let surface;

function setup() {
  createCanvas(560, 390);

  //initialize box2d physics and create the world
  world = createWorld();

  //create the surface
  surface = new Surface();
}

function draw() {
  background(220);

  //we must always step through time
  let timeStep = 1.0 / 30;
  //second and third arguments are velocity and position iterations
  world.Step(timeStep, 10, 10);

  //particles fall from the top every so often
  if (random(1) < 0.5) {
    let sz = random(4, 8);
    particles.push(new Particle(width / 2, 10, sz));
  }

  //draw the surface
  surface.display();

  //display all the particles
  for (let i = particles.length - 1; i >= 0; i--) {
    particles[i].display();
    if (particles[i].done()) {
      particles.splice(i, 1);
    }
  }
}
//a rectangular box
class Particle {
  constructor(x, y, r) {
    this.r = r;

    //define a body
    let bd = new box2d.b2BodyDef();
    bd.type = box2d.b2BodyType.b2_dynamicBody;
    bd.position = scaleToWorld(x, y);

    //define a fixture
    let fd = new box2d.b2FixtureDef();
    //fixture holds shape
    fd.shape = new box2d.b2CircleShape();
    fd.shape.m_radius = scaleToWorld(this.r);

    //some physics
    fd.density = 1.0;
    fd.friction = 0.1;
    fd.restitution = 0.3;

    //create the body
    this.body = world.CreateBody(bd);
    //attach the shape to the body with the fixture
    this.body.CreateFixture(fd);

    //some additional stuff
    this.body.SetLinearVelocity(new box2d.b2Vec2(random(-5, 5), random(2, 5)));
    this.body.SetAngularVelocity(random(-5, 5));
  }

  //this function removes the particle from the box2d world
  killBody() {
    world.DestroyBody(this.body);
  }

  //check if the particle ready for deletion
  done() {
    //find the screen position of the particle
    let transform = this.body.GetTransform();
    let pos = scaleToPixels(transform.position);
    //check if it is off the bottom of the screen
    if (pos.y > height + this.r * 2) {
      this.killBody();
      return true;
    }
    return false;
  }

  //draw the Particle
  display() {
    //get the body's position
    let pos = scaleToPixels(this.body.GetPosition());
    //get its angle of rotation
    let a = this.body.GetAngleRadians();

    //drawing object using ellipse()
    rectMode(CENTER);
    push();
    translate(pos.x, pos.y);
    rotate(a);
    fill(63,63,147);
    stroke(150);
    strokeWeight(2);
    ellipse(0, 0, this.r * 2, this.r * 2);
    //add a line so we can see the rotation
    line(0, 0, this.r, 0);
    pop();
  }
}
//an uneven surface boundary and a fixed boundary class
class Surface {
  constructor() {
    this.surface = [];
    //keep track of the screen coordinates of the chain
    this.surface.push(new box2d.b2Vec2(0, height / 2));
    this.surface.push(new box2d.b2Vec2(width / 2, height / 2 + 100));
    this.surface.push(new box2d.b2Vec2(width, height / 2));

    for (let i = 0; i < this.surface.length; i++) {
      this.surface[i] = scaleToWorld(this.surface[i]);
    }

    //this is what box2d uses to put the surface in its world
    let chain = new box2d.b2ChainShape();
    chain.CreateChain(this.surface, this.surface.length);

    //a body to attach shape
    let bd = new box2d.b2BodyDef();
    this.body = world.CreateBody(bd);

    //define a fixture
    let fd = new box2d.b2FixtureDef();
    //fixture holds shape
    fd.shape = chain;

    //some physics
    fd.density = 1.0;
    fd.friction = 0.1;
    fd.restitution = 0.3;

    //attach the fixture
    this.body.CreateFixture(fd);
  }

  //a function to just draw the edge chain as a series of vertex points
  display() {
    strokeWeight(1);
    stroke(50);
    fill(100);
    beginShape();
    for (let i = 0; i < this.surface.length; i++) {
      let v = scaleToPixels(this.surface[i]);
      vertex(v.x, v.y);
    }
    vertex(width, height);
    vertex(0, height);
    endShape(CLOSE);
  }
}
                            </code></pre>
                        </div>
                        <span class="p5 object">
                            <iframe style="width: 100%; height: 100%; overflow: hidden; padding-top: 36px;" scrolling="no" src="https://editor.p5js.org/liz-peng/embed/OqPd_U7U7"></iframe>
                        </span>
                    </section>

                    <!-- section 5.4 -->
                    <section class="banner">
                        <div class="content">
                            <header>
                                <h3>Example 5.4<br>Polygon Shapes
                                </h3>
                            </header>
                            <p>
                                Click to add polygon shapes &nbsp; <a href="https://editor.p5js.org/liz-peng/sketches/xzyZ5oBZo" target="_blank" class="button">p5.js</a>
                            </p>
                            <!-- code -->
                            <pre><code>//a reference to our box2d world
let world;
//list of boundaries to track fixed objects
let boundaries = [];
//list of rectangles
let polygons = [];

function setup() {
  createCanvas(560, 390);
  let text = createP("Click and drag to add box");
  text.position(15, 5);

  //initialize box2d physics and create the world
  world = createWorld();

  //add a bunch of fixed boundaries
  boundaries.push(new Boundary(width / 4, height - 5, width / 2 - 50, 10, 0));
  boundaries.push(new Boundary(3 * width / 4, height - 50, width / 2 - 50, 10, 0));
  boundaries.push(new Boundary(width - 5, height / 2, 10, height, 0));
  boundaries.push(new Boundary(5, height / 2, 10, height, 0));
}

function draw() {
  background(220);

  //we must always step through time
  let timeStep = 1.0 / 30;
  //second and third arguments are velocity and position iterations
  world.Step(timeStep, 10, 10);

  //display all the boundaries
  for (let i = 0; i < boundaries.length; i++) {
    boundaries[i].display();
  }

  //display all the boxes
  for (let i = polygons.length - 1; i >= 0; i--) {
    polygons[i].display();
    if (polygons[i].done()) {
      polygons.splice(i, 1);
    }
  }
}

function mousePressed() {
  let cs = new CustomShape(mouseX, mouseY);
  polygons.push(cs);
}
// a boundary is a simple rectangle with x,y,width,and height
class Boundary {
  constructor(x, y, w, h) {
    this.x = x;
    this.y = y;
    this.w = w;
    this.h = h;

    let fd = new box2d.b2FixtureDef();
    fd.density = 1.0;
    fd.friction = 0.5;
    fd.restitution = 0.2;

    let bd = new box2d.b2BodyDef();

    bd.type = box2d.b2BodyType.b2_staticBody;
    bd.position = scaleToWorld(this.x, this.y);
    fd.shape = new box2d.b2PolygonShape();
    fd.shape.SetAsBox(this.w / (scaleFactor * 2), this.h / (scaleFactor * 2));
    this.body = world.CreateBody(bd).CreateFixture(fd);
  }

  //draw the boundary, if it were at an angle we'd have to do something fancier
  display() {
    fill(100);
    stroke(50);
    rectMode(CENTER);
    rect(this.x, this.y, this.w, this.h);
  }
}
// cusomized rectangular box
class CustomShape {
  constructor(x, y) {

    //define a body
    let bd = new box2d.b2BodyDef();
    bd.type = box2d.b2BodyType.b2_dynamicBody;
    bd.position = scaleToWorld(x, y);

    //define a fixture
    let fd = new box2d.b2FixtureDef();

    let vertices = [];
    vertices[3] = scaleToWorld(-15, 25);
    vertices[2] = scaleToWorld(15, 0);
    vertices[1] = scaleToWorld(20, -15);
    vertices[0] = scaleToWorld(-10, -10);

    //fixture holds shape
    fd.shape = new box2d.b2PolygonShape();
    fd.shape.SetAsArray(vertices, vertices.length);

    //some physics
    fd.density = 1.0;
    fd.friction = 0.5;
    fd.restitution = 0.2;

    //create the body
    this.body = world.CreateBody(bd);
    //attach the shape to the body with the fixture
    this.body.CreateFixture(fd);
  }

  //this function removes the particle from the box2d world
  killBody() {
    world.DestroyBody(this.body);
  }

  //check if the particle ready for deletion
  done() {
    //find the screen position of the particle
    let pos = scaleToPixels(this.body.GetPosition());
    //check if it is off the bottom of the screen
    if (pos.y > height + this.w * this.h) {
      this.killBody();
      return true;
    }
    return false;
  }

  //drawing the box
  display() {
    //get the body's position
    let pos = scaleToPixels(this.body.GetPosition());
    //get its angle of rotation
    let a = this.body.GetAngleRadians();

    //draw it
    let f = this.body.GetFixtureList();
    let ps = f.GetShape();

    rectMode(CENTER);
    push();
    translate(pos.x, pos.y);
    rotate(a);
    fill(63,63,147);
    stroke(50);
    strokeWeight(2);
    ellipse(0, 0, 20, 20);
    beginShape();
    //for every vertex, convert to pixel vector
    for (let i = 0; i < ps.m_count; i++) {
      let v = scaleToPixels(ps.m_vertices[i]);
      vertex(v.x, v.y);
    }
    endShape(CLOSE);
    pop();
  }
}
                            </code></pre>
                        </div>
                        <span class="p5 object">
                            <iframe style="width: 100%; height: 100%; overflow: hidden; padding-top: 36px;" scrolling="no" src="https://editor.p5js.org/liz-peng/embed/xzyZ5oBZo"></iframe>
                        </span>
                    </section>
				</div>
			</div>
			
			<!-- sidebar -->
			<div id="sidebar">
				<div class="inner">
					<!-- menu -->
					<nav id="menu">
						<header class="major">
							<h2>The Nature Of Code</h2>
						</header>
						<ul>
							<li><a href="index.html">Introduction</a></li>
							<li><a href="vectors.html">Vectors</a></li>
                            <li><a href="forces.html">Forces</a></li>
                            <li><a href="oscillation.html">Oscillation</a></li>
                            <li><a href="particle-systems.html">Particle Systems</a></li>
                            <li><a href="physics-libraries.html">Physics Libraries</a></li>
						</ul>
					</nav>
					
					<!-- Footer -->
					<footer id="footer">
						<ul class="contact">
							<li class="fa-envelope-o">speng2@wpi.edu&nbsp; (Liz Peng)</li>
						</ul>
					</footer>
				</div>
			</div>
		</div>

		<!-- scripts -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/main.js"></script>

	</body>
</html>